<div th:fragment="scripts">

    <script th:inline="javascript" type="module">
        import {loadClientData} from './app.js';

        window.currentUser = {
            appHost : '',
            userName: '',
            userAlias: '',
            currentIndex: 0,
            maxResultCount: 0,
            dataSource : '',
            lastViewed : '',
            siteMap : null,
            clientData : null,
            userProfile : null
        };

         window.maxResultCount = 1;
         window.dataSource = [[${data_source}]];
         window.appHost = "http://192.168.1.110:8080";

        document.addEventListener("DOMContentLoaded", function() {
            loadClientData(window.dataSource, 0);
        });
    </script>

    <script th:inline="javascript" type="module">

        import {loadClientData} from './app.js';
        import {navigateClientData} from './app.js';
        import {prepareIndex} from './app.js';
        import {getUserProfile} from './app.js';
        import {addFavorites} from './app.js'; navigateFavoritesData
        import {navigateFavoritesData, navigateClientUrl} from './app.js';

        window.addUserFavorites = function addUserFavorites(dataSource, articleId){
            let url = window.appHost + dataSource;
            addFavorites (url, articleId);
            disableElement('favorite-id-' + articleId, true);
        }

        window.navigateFavorites = function navigateFavorites(){
            hideMainControl();
            navigateFavoritesData('/app-data-favorites');
        }

        window.navigate = function navigate(direction) {                
                let index = prepareIndex(direction);
                console.log("direction : " + direction + " : " + index);
                navigateClientData(window.dataSource, index)
        }
        window.navigateClientCatalogData =  function navigateClientCatalogData(dataSource, siteName, startIndex){
                let url = dataSource + siteName;
                console.log("catalog  data source : " + url);
                navigateClientData(url, startIndex)
                let navTitle = document.querySelector('#navigated-title');
                navTitle.textContent = siteName;
        }
        window.search = function search(dataSource){
                let searchInput = document.querySelector('#search-input');
                let url = dataSource + '/' + searchInput.value;
                navigateClientData(url, '0')
                console.log("searching : " + url);
        }
        window.hideMainControl = function hideMainControl(){
                document.querySelector('#main-navigation').hidden = true;
                document.querySelector('#app-header-placeholder').hidden = true;
                document.querySelector('#footer').hidden = true;
                document.querySelector('#navigate-control-left').hidden = true;
                document.querySelector('#navigate-control-right').hidden = true;
        }
        window.showMainControl = function showMainControl(){
            document.querySelector('#app-header-placeholder').hidden = false;
            document.querySelector('#main-navigation').hidden = false;
            document.querySelector('#footer').hidden = false;
            document.querySelector('#navigate-control-left').hidden = false;
            document.querySelector('#navigate-control-right').hidden = false;
        }

         window.getUser = function getUser(){
                hideMainControl();
                let url = '/app-user-profiler';
                getUserProfile(url)
                console.log("user profiler url : " + url);
        }
        window.backStep = function backStep(){
            //document.querySelector('#profile-control').hidden = true;
            showMainControl();
            window.userProfile = null;

            let mainContainer = document.querySelector('#current-view');
            let temp = mainContainer.innerHTML;

            mainContainer.innerHTML = window.lastViewed ;

            window.lastViewed = temp;
        }
        window.setCookie = function setCookie(username){
            let date = new Date(Date.now() + 8644400e3);
            date = date.toUTCString();
        
            if(username != undefined){
               document.cookie = "username=" + username;
               document.cookie  =  "path=/";
               document.cookie  = "expires=" + date;
               document.cookie = "sameSite=Lax";
               console.log("Set cookie : " + document.cookie);
            }
        }
        window.reLogin = function reLogin(){
            window.location.replace(window.appHost);
        }
        window.removeElement = function removeElement(id){
            document.getElementById(id).remove();
        }
        window.disableElement = function disableElement(id, state){
            console.log('state : ' + state + ' id : ' + id);
            document.getElementById(id).disabled = state;
        }
        window.existsFavorite = function existsFavorite(favoriteId){
            for( let item of window.clientData.favorites){
                    if(favoriteId == item.id) return true;
            }
            return false;
        }

    </script>
</div>